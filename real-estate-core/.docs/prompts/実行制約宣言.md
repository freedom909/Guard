 企业级业务系统详细设计事实清单 1. 角色与权限定义 (RBAC) 基于 Architect.md 与 RBAC権限境界表.md 的事实提取。 1.1 已定义角色 (Roles) 角色名称 定义来源 职责范围 (Scope) Admin Architect.md 系统管理员。拥有所有资源和用户管理的完全访问权限。 Agent Architect.md 经过验证的房地产经纪人。管理房源 (Listings)、合同 (Contracts) 和交易 (Transactions)。 Owner Architect.md 房产所有者。管理拥有的房产，查看报价 (Offers)。 Customer Architect.md 最终用户（默认角色）。只读访问公开房源，写入访问自己的个人资料。 Pending_Agent Architect.md 未验证员工。仅限入职 (Onboarding) 和验证相关的受限访问。 1.2 权限执行边界 (Permission Boundaries) 注意：以下权限仅包含文档中明确“允许 (Allowed)”或“禁止 (Forbidden)”的项目。未提及的项目均归类为 Undefined。 Admin Allowed: Full access to all resources (所有资源的完全访问权限) User management (用户管理) Undefined / Need Decision: 审计日志的删除权限 系统配置 (Config) 的变更权限 Agent Allowed: Management of listings (房源管理) Management of contracts (合同管理) Management of transactions (交易管理) Undefined / Need Decision: User management (是否仅限 Admin？) Viewing of offers (是否仅限 Owner？) 自身的个人资料更新 (Own profile update) Owner Allowed: Management of owned properties (自有房产管理) Viewing of offers (查看报价) Undefined / Need Decision: 对报价的响应（承诺/拒绝） Listings/Contracts 的参照权限 自身的个人资料更新 Customer Allowed: Read-only access to public listings (公开房源只读访问) Write access to own profile (自身资料写入访问) Undefined / Need Decision: 创建报价 (Create Offer) 向 Agent 咨询 (Contact Agent) Pending_Agent Allowed: Access specific onboarding endpoints (Document Upload, Status Check) Read their own user profile Forbidden: Business-critical write operations (Listings, Contracts) Undefined / Need Decision: Read-only access to public listings (是否继承 Customer 权限？) 2. 业务状态迁移 (Business State Transitions) 基于 状態遷移表.md 的事实提取。 注意：此表中的“判断主体”与 RBAC 角色之间未建立明确映射关系（详见第 3 节）。 状态变迁 判断主体 (Actor) 成立依据 (Logic) ERP 关系 例外/滞留条件 S01 → S02 買主（業務担当者） 申请内容被受理，受理处理完成 ERP未联合 受理处理未完成 (S01) S02 → S03 売主・買主 缔结记录确定 ERP确认合同完成 申请信息不备 (→S01) 合同条件模糊 (S02) S03 → S04 売主（経理担当者） 入金确认及结算完成被承认 ERP确认结算完成 入金未确认 (S03) S04 → S05 売主・買主 业务上的交易全部完成 ERP确认完成 商品缺货 (→S0X) 期限超过 (法务应对) 3. 未定义事项与决策需求 (Undefined / Need Decision) 基于输入文档的严格比对，以下事项在当前文档集中缺失定义或存在断层，无法进行推导。 3.1 角色与业务主体的映射缺失 (Critical Gap) Architect.md 定义了系统角色 (Admin, Agent, Owner, Customer)，而 状態遷移表.md 定义了业务主体 (売主, 買主, 業務担当者, 経理担当者)。文档中不存在两者之间的映射表。 Undefined: Customer 是否等同于 買主？ Undefined: Owner 是否等同于 売主？ Undefined: Agent 是否对应 業務担当者 或 経理担当者？ Undefined: Admin 在状态迁移中的位置？ 3.2 关键业务操作的权限归属缺失 虽然 Architect.md 提及了高层级的能力（如 "Management of listings"），但在 RBAC権限境界表.md 中明确指出了以下具体操作的未定义状态： Offer (报价) 流程断裂: Owner 被允许 "Viewing of offers"。 Undefined: 谁有权限 "Create Offer"？（通常是 Customer，但文档未定义，故视为 Undefined）。 Undefined: 谁有权限 "Accept/Reject Offer"？（文档未定义 Owner 是否有此权限）。 Pending_Agent 的继承性: Undefined: Pending_Agent 是否自动继承 Customer 的 "Read-only access to public listings"？（Architect.md 仅提及默认用户为 Customer，但 Pending_Agent 是显式分配的角色，是否包含 Customer 权限未明示）。 3.3 状态迁移中的系统行为 Undefined: 状態遷移表.md 中提及的 "ERP未連携" 和 "ERP（販売管理）" 是指系统自动对接还是人工操作？ Undefined: 状态 S0X (返金) 的后续流转和权限定义。 生成结论： 当前设计文档在 RBAC 角色 与 业务流程主体 之间存在严重的定义断层。无法生成完整的权限控制矩阵，需优先解决 3.1 中的映射关系定义。

本ドキュメントは「事実抽出結果」であり、
以下の実行制約をもって
企業級業務システムの詳細設計として確定する。

1. RBAC 実行ルール
- 権限判定は「Allowed」と明示された操作のみを許可する。
- 「Undefined / Need Decision」と記載された操作は、
  いかなる場合も Allow として解釈してはならない。
- Undefined 操作は、実装上はすべて「Deny（拒否）」として扱う。

2. 業務状態遷移の実行ルール
- 状態遷移表に記載された遷移のみを有効とする。
- 判断主体と RBAC ロールの対応が未定義の場合、
  当該状態遷移は「管理者承認またはシステム保留」とする。
- 未定義の状態（例：S0X）は実行不可状態として扱い、
  明示的な定義が行われるまで自動遷移・API 呼び出しを禁止する。

3. 実装禁止事項
- 本ドキュメントにおいて Undefined とされた操作・遷移・権限について、
  推測・慣習・一般的業務知識を根拠に
  実装・API 公開・UI 表示を行ってはならない。
